#include <reg51.h>
sbit   speaker = P2^5;
unsigned char timer0h, timer0l, time;
//--------------------------------------
code unsigned char FREQH[] = {
    0xF2, 0xF3, 0xF5, 0xF5, 0xF6, 0xF7, 0xF8,    //1234567
    0xF9, 0xF9, 0xFA, 0xFA, 0xFB, 0xFB, 0xFC, 0xFC,//1,2,3,4,5,6,7,i
    0xFC, 0xFD, 0xFD, 0xFD, 0xFD, 0xFE,            // 234567
    0xFE, 0xFE, 0xFE, 0xFE, 0xFE, 0xFE, 0xFF};   // 1234567
 
code unsigned char FREQL[] = {
    0x42, 0xC1, 0x17, 0xB6, 0xD0, 0xD1, 0xB6,    //1234567
    0x21, 0xE1, 0x8C, 0xD8, 0x68, 0xE9, 0x5B, 0x8F, //1,2,3,4,5,6,7,i
    0xEE, 0x44, 0x6B, 0xB4, 0xF4, 0x2D,             // 234567
    0x47, 0x77, 0xA2, 0xB6, 0xDA, 0xFA, 0x16};
//--------------------------------------
code unsigned char qu[] = {
6,1,4,  1,2,4,  5,2,4, 1,2,4,  4,1,4, 5,1,2,  6,1,2,  5,2,4,  1,2,4, 
1,1,4,  5,1,4,  5,2,4, 1,2,4, 1,1,4, 5,2,4,  7,1,4,  5,2,4,
6,1,4,  1,2,4,  5,2,4, 6,1,4, 4,1,4, 5,1,2,  6,1,2,  5,2,4, 1,2,4,
1,1,4,  5,1,4,  5,2,4, 1,2,4, 1,1,4, 5,2,4,  7,1,2,  1,2,2, 5,2,4,//前奏
5,2,4,  5,2,4,  1,2,4, 1,2,8, 2,2,4, 3,2,4,  //故事的小黄花
5,2,4,  5,2,4,  1,2,4, 2,2,2, 3,2,2, 2,2,2,  1,2,2,  5,1,4,//从出生那年就飘着
5,2,4,  5,2,4,  1,2,4, 1,2,8, 2,2,4, 3,2,4,//童年的荡秋千
3,2,4,  2,2,2,  3,2,2, 4,2,2, 3,2,2, 2,2,2,  4,2,2,  3,2,2, 2,2,2, 1,2,4,//随记忆一直晃到现在
5,1,4,  1,2,4,  1,2,4, 3,2,4, 4,2,4, 3,2,4,  2,2,4,  1,2,2, 2,2,4, 3,2,4,  3,2,4, 3,2,4,  3,2,4,  2,2,2,  3,2,2,  2,2,4, 1,2,8, //Re So So Si Do Si La  So  La Si Si Si La Si La So 
5,1,4,  1,2,4,  2,2,4,  3,2,4, 4,2,4, 3,2,4, 2,2,4,  1,2,2,//吹着前奏望着天空 
2,2,2,  3,2,4,  3,2,4,  3,2,4,  3,2,4,  2,2,2,  3,2,2,	2,2,4, 1,2,2,//我想起花瓣试着掉落
7,1,2,  1,2,2,  1,2,2,  1,2,2,  1,2,2,  7,1,2,  1,2,4, 1,2,2, //为你翘课的那一天
1,2,2, 1,2,2, 1,2,2, 1,2,2,	7,1,2, 1,2,4, 1,2,2, //花落得那一天
1,2,2, 1,2,2, 1,2,2, 1,2,2, 7,1,2, 1,2,4, 1,2,2, //教室的那一间
1,2,2, 1,2,2, 1,2,2, 1,2,2, 5,2,2, 5,2,4, 5,2,2,//我怎么看不见
5,2,2, 5,2,2, 5,2,2, 5,2,2, 5,2,4, 5,2,2, //消失的下雨天
5,2,2, 5,2,2, 5,2,2, 5,2,2,	4,2,2, 3,2,2, 3,2,2, //我好想再淋一遍
1,2,2, 1,2,2, 1,2,2, 1,2,2, 6,1,4, 7,1,4, 1,2,4, 5,2,4, 4,2,4, 3,2,4, 1,2,4, 1,2,4,//没想到失去的勇气我还留着
1,2,2, 1,2,2, 1,2,2, 1,2,2, 3,2,4, 1,2,4, //好想再问一遍
6,1,4, 7,1,4, 1,2,4, 5,2,4, 4,2,4, 3,2,4, 1,2,4, 2,2,4, 2,2,10,//你会等待还是离开
3,2,4, 2,2,4, 4,2,4, 3,2,8, 1,2,4, 5,2,4, 7,2,4, 1,3,4, 7,2,4, 1,2,4, 1,2,8,// 刮风这天我试过握着你手
1,2,4, 6,2,4, 6,2,4, 6,2,4, 5,2,4, 5,2,8, 5,2,4, 4,2,4, 3,2,4, 2,2,4, 3,2,4, 3,2,4, 3,2,10,//但偏偏雨渐渐大到我看你不见
3,2,4, 4,2,4, 5,2,4, 3,2,8, 4,2,4, 5,2,4, 7,2,4, 2,3,4, 7,2,4, 1,3,4, 1,3,8,//还要多久我才能在你身边
1,3,4, 1,3,4, 5,2,4, 5,2,4, 6,2,4, 5,2,2, 4,2,2, 4,2,4, 2,2,4, 3,2,4, 4,2,4, 5,2,4, 6,2,4, 1,2,4, 6,2,6, 7,2,2, 7,2,4, //等到放晴的那天也许我会比较好一点
3,2,4, 2,2,4, 4,2,4, 3,2,8, 1,2,4, 5,2,4, 7,2,4, 1,3,4, 7,2,4, 1,2,4, 1,2,8,//从前从前有个人爱你很久
1,2,4, 6,2,4, 6,2,4, 6,2,4, 5,2,4, 5,2,8, 5,2,4, 4,2,4, 3,2,4, 2,2,4, 3,2,4, 4,2,4, 3,2,4, 3,2,10,//但偏偏风渐渐把距离吹的好远
3,2,4, 4,2,4, 5,2,4, 3,2,8, 4,2,4, 5,2,4, 7,2,4, 2,3,4, 7,2,4, 1,3,4, 1,3,4,// 好不容易又能再多爱一天
1,3,4, 1,3,4, 5,2,4, 5,2,4, 6,2,4, 5,2,4, 4,2,4, 6,1,4, 7,1,4, 1,2,4, 2,2,4, 3,2,4, 2,2,4, 3,2,4, 1,2,4, 1,2,10, //但故事的最后你好像还是说了拜拜
0,0,0,}  ;
 
  void t0int() interrupt 1   
{
    TR0 = 0;
    speaker = !speaker;
    TH0 = timer0h;     
    TL0 = timer0l;
    TR0 = 1; 
}
//--------------------------------------
void delay(unsigned char t)     
{
    unsigned char t1;
    unsigned long t2;
    for(t1 = 0; t1 < t; t1++)
      for(t2 = 0; t2 < 1900; t2++); 
    TR0 = 0;
}
//--------------------------------------
void song()                     
{
    TH0 = timer0h;               
    TL0 = timer0l;
    TR0 = 1;                     
    delay(time);
}
//--------------------------------------
void main()
{
    unsigned char k;
	unsigned long int i;
    TMOD = 1;
    ET0 = 1; 
    EA = 1;
    while(1) {
      i = 0;
      time = 1;
      while(time) {
        k = qu[i] + 7 * qu[i + 1] - 1;
        timer0h = FREQH[k];
        timer0l = FREQL[k];
        time = qu[i + 2];
        i += 3;
        song();
				}
}
}